import{w as u}from"./D8ajXV1s.js";class f{constructor(e={}){this._storageKey="appConfig",this._defaultSettings={...e},this._settings={},this._subscribers={},typeof window<"u"?(this._loadFromStorage(),this._attachAutoSave()):this._settings={...this._defaultSettings}}_loadFromStorage(){try{const e=localStorage.getItem(this._storageKey);if(e){const t=JSON.parse(e);this._settings={...this._defaultSettings,...t}}else this.default()}catch(e){console.error("Failed to load configuration:",e),this.default()}}_attachAutoSave(){window.addEventListener("beforeunload",()=>{this.save()})}subscribe(e,t){this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e].push(t)}unsubscribe(e,t){this._subscribers[e]&&(this._subscribers[e]=this._subscribers[e].filter(r=>r!==t))}_notify(e,t){this._subscribers[e]&&this._subscribers[e].forEach(r=>r(t))}default(){return this._settings={...this._defaultSettings},this}save(){if(typeof window>"u")return!1;try{return localStorage.setItem(this._storageKey,JSON.stringify(this._settings)),!0}catch(e){return console.error("Failed to save configuration:",e),!1}}set(e,t){return this._settings[e]=t,this._notify(e,t),this}async setConfig(e,t){if(e&&(this._settings=e),t&&typeof t=="object")try{await this.setAllMedia(t)}catch(r){console.error("Ошибка при загрузке медиа-файлов в setConfig:",r)}}load(){return typeof window<"u"&&this._loadFromStorage(),this}getConfig(){return this._settings}get(e){return this._settings[e]}async getMedia(e){try{const t=await this._loadMedia(e);if(t)return t}catch(t){console.error(` "${e}":`,t)}}async setMedia(e,t){try{return await this._saveMedia(e,t),this._notify(e,t),!0}catch(r){return console.error(`Ошибка в загрузке медиа "${e}":`,r),!1}}async deleteMedia(e){try{return await this._deleteMedia(e),!0}catch(t){return console.error(`Ошибка в удалении медиа "${e}":`,t),!1}}async hasMedia(e){return!!await this._loadMedia(e)}_openDB(){return new Promise((e,t)=>{const r=indexedDB.open("AppMediaStore",1);r.onupgradeneeded=i=>{const o=i.target.result;o.objectStoreNames.contains("media")||o.createObjectStore("media")},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}async _saveMedia(e,t){const r=await this._openDB();return new Promise((i,o)=>{const a=r.transaction("media","readwrite").objectStore("media").put(t,e);a.onsuccess=()=>i(!0),a.onerror=()=>o(a.error)})}async _loadMedia(e){const t=await this._openDB();return new Promise((r,i)=>{const s=t.transaction("media","readonly").objectStore("media").get(e);s.onsuccess=()=>r(s.result),s.onerror=()=>i(s.error)})}async _deleteMedia(e){const t=await this._openDB();return new Promise((r,i)=>{const s=t.transaction("media","readwrite").objectStore("media").delete(e);s.onsuccess=()=>r(!0),s.onerror=()=>i(s.error)})}async getAllMedia(){const e=await this._openDB();return new Promise((t,r)=>{const n=e.transaction("media","readonly").objectStore("media").getAllKeys();n.onsuccess=async()=>{const s=n.result,a={},h=e.transaction("media","readonly").objectStore("media");let d=s.length;if(d===0)return t(a);for(const l of s){const c=h.get(l);c.onsuccess=()=>{a[l]=c.result,--d===0&&t(a)},c.onerror=()=>{r(c.error)}}},n.onerror=()=>r(n.error)})}async setAllMedia(e){const t=await this._openDB();return new Promise((r,i)=>{const o=t.transaction("media","readwrite"),n=o.objectStore("media");try{for(const[s,a]of Object.entries(e))n.put(a,s);o.oncomplete=()=>r(!0),o.onerror=()=>i(o.error)}catch(s){i(s)}})}async deleteAllMedia(){const e=await this._openDB();return new Promise((t,r)=>{const n=e.transaction("media","readwrite").objectStore("media").clear();n.onsuccess=()=>t(!0),n.onerror=()=>r(n.error)})}}const g={timerDuration:55,setTime:"04:00",timeAddSubStep:"00:05",shuffleKey:"KeyR",toggleTimer:"KeyW",pauseKey:"Space",theme:"green",shuffleAnimation:"Spring",extraButtonsOn:!0,extraButtonsPauseOn:!0,panelAutoPause:!0,panelAutoOpen:!0,menuAutoPause:!0,timerBlackOut:!0,timerEndSound:!0,afterSound:!0,introGuide:!0,audioTimerEnd:null,playerBackground:!0,usingBackroundImage:!1,backgroundImage:null},b=new f(g);let w=u(null);const y=u(b.get("introGuide")),S=u(!1),x=u(!1);export{b as G,y as I,w as S,S as a,g as d,x as i};
