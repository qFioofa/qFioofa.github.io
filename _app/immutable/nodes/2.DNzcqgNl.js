import"../chunks/DsnmJJEf.js";import"../chunks/CHrNWWIQ.js";import{D as B,L as S,J as L,K as F,az as g,ay as M,aA as y,aD as G,u as $,z as f,aw as j,Q as N,I as W}from"../chunks/mMZIm3FY.js";import{l as I,B as Y,M as D,b as X,S as J,e as K,i as ee,A as te,V as o,C as ae,c as oe,d as ne,Q as re,f as se,D as ie,T as le,s as ce,L as de,g as pe,h as me,a as he}from"../chunks/xH_1riKm.js";import{s as A,e as fe,o as ue,a as we}from"../chunks/B7QtofqP.js";import{i as E}from"../chunks/yrK08LK-.js";import{p as ye}from"../chunks/DpMMM5bs.js";import{g as ge}from"../chunks/DNUZq-PW.js";import{C as ve}from"../chunks/B3cIF7Kt.js";const C={male:"male",female:"female",robot:"robot"},V=C.robot;function H(){const n=new Y(.001,.001,.001),e=new D({color:16753920});return new X(n,e)}async function Me(c=V,n="PlayerCharacterModels",e="head",t="body",a=3,r=3){const i=`/${n}/${c}/${c}`,s=`${i}_${t}`,p=`${i}_${e}`,l=await I(s,`${c}_${t}`)||H(),d=await I(p,`${c}_${e}`)||H();return d.scale.set(a,a,a),l.scale.set(r,r,r),{body:l,head:d}}var xe=S('<button class="menu-item svelte-195wgof"><div class="text-3d-container svelte-195wgof"><h2 class="menu-text svelte-195wgof"><span class="text-layer front svelte-195wgof"> </span> <span class="text-layer middle svelte-195wgof"> </span> <span class="text-layer back svelte-195wgof"> </span></h2></div></button>'),be=S('<div class="main-menu-container svelte-195wgof"><div class="menu-panel svelte-195wgof"><h1 class="menu-title svelte-195wgof">Обратка</h1> <!> <div class="menu-items svelte-195wgof"></div></div></div>');function Pe(c,n){B(n,!1);let e=ye(n,"onSelect",8,null),t=[{id:"solo",text:"1️⃣ Одиночная",route:"/solo"},{id:"how_to_play",text:"❔ Как играть",route:"/how_to_play"}];function a(l){e()&&e()(l),te.play("Button/MidButton"),setTimeout(()=>ge(l.route),300)}E();var r=be(),i=g(r),s=M(g(i),2);J(s);var p=M(s,2);K(p,5,()=>t,ee,(l,d)=>{var u=xe(),P=g(u),_=g(P),x=g(_),b=g(x,!0);y(x);var v=M(x,2),m=g(v,!0);y(v);var h=M(v,2),w=g(h,!0);y(h),y(_),y(P),y(u),G(()=>{A(b,(f(d),$(()=>f(d).text))),A(m,(f(d),$(()=>f(d).text))),A(w,(f(d),$(()=>f(d).text)))}),fe("click",u,()=>a(f(d))),L(l,u)}),y(p),y(i),y(r),L(c,r),F()}const _e={nullMap:{light:[],props:[],playerPoints:[]},threeAtTable:{light:[],props:[],playerPoints:[{point:new o(6.5,-2,-3),upLook:new o(0,0,-.1)},{point:new o(4,-2,-6),upLook:new o(0,0,-.1)},{point:new o(0,-2,-6),upLook:new o(0,0,-.1)}]},theater:{light:[],props:[],playerPoints:[{point:new o(0,0,-4),upLook:new o(0,0,4)},{point:new o(2,0,-4),upLook:new o(0,0,4)},{point:new o(-2,0,-4),upLook:new o(0,0,4)},{point:new o(4,0,-4),upLook:new o(0,0,4)},{point:new o(-4,0,-4),upLook:new o(0,0,4)},{point:new o(6,0,-4),upLook:new o(0,0,4)},{point:new o(-6,0,-4),upLook:new o(0,0,4)},{point:new o(8,0,-4),upLook:new o(0,0,4)},{point:new o(-8,0,-4),upLook:new o(0,0,4)}]}},ke="theater";function Ce(c="",n={}){const e={fontSize:72,fontFamily:"Arial, sans-serif",color:"#ffffff",backgroundColor:"transparent",padding:20,borderWidth:0,borderColor:"#ffffff",maxWidth:512,...n},t=document.createElement("canvas"),a=t.getContext("2d");a.font=`${e.fontSize}px ${e.fontFamily}`;const r=Math.min(a.measureText(c).width,e.maxWidth),i=e.fontSize;t.width=r+e.padding*2,t.height=i+e.padding*2,a.clearRect(0,0,t.width,t.height),a.fillStyle=e.backgroundColor,a.fillRect(0,0,t.width,t.height),e.borderWidth>0&&(a.strokeStyle=e.borderColor,a.lineWidth=e.borderWidth,a.strokeRect(0,0,t.width,t.height)),a.font=`${e.fontSize}px ${e.fontFamily}`,a.fillStyle=e.color,a.textAlign="center",a.textBaseline="middle",a.fillText(c,t.width/2,t.height/2);const s=new ae(t);s.needsUpdate=!0;const p=t.width/t.height,l=new oe({map:s,transparent:!0}),d=new ne(l);return d.scale.set(p,1,1),d}class Le{constructor(n,e){this.scene=e,this.mapName=n,this.playerPointsMap=new Map}load(n=[],e){const t=_e[this.mapName]||ke;n=n.filter(s=>s.playerName!==e);const{light:a,props:r,playerPoints:i}=t;this._loadScene(a,r),this._setPlayersPosition(n,i)}_loadScene(n=[],e=[]){if(!this.scene)return[];const t=[...n,...e];return t.forEach(a=>this.scene.add(a)),t}async _setPlayersPosition(n=[],e=[]){const t=Math.min(n.length,e.length);for(let a=0;a<t;a++){const r=n[a],i=e[a];!r||!i||await this._setPlayerModel(r.playerName,r.model,i.point,i.upLook)}}async _setPlayerModel(n,e=V,t=new o(0,0,0),a=new o(0,0,1),r=new o(0,2,0),i=new o(0,4.5,0)){const{body:s,head:p}=await Me(e);s.position.copy(t),p.position.copy(t),p.position.add(r);const l=new re,d=new o(0,1,0);l.setFromUnitVectors(d,a.normalize()),s.quaternion.copy(l),p.quaternion.copy(l),this.scene.add(s),this.scene.add(p);const u=Ce(n,{fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.5)",padding:10,borderRadius:5});u.position.copy(t),u.position.add(i),u.quaternion.copy(l),this.scene.add(u),this.playerPointsMap.set(n,{body:s,head:p,nameSprite:u,point:t,upVector:a})}getPlayerPosition(n){const e=this.playerPointsMap.get(n);return e||{point:new o(0,0,0),upVector:new o(1,0,0)}}setPlayerCharacterHeadLook(n,e){const t=this.playerPointsMap.get(n);if(!t||!e)return;const{head:a}=t;a.rotation.y=e.y,a.rotation.x=e.x}}function Se(c,n=new o(15,10,15),e=new o(0,-3.5,-.6),t=2,a="/Props/Secret/Secret.png"){const i=new se().load(a),s=new D({map:i,side:ie,transparent:!0}),p=new Y(1,1,1),l=new X(p,s);return l.position.copy(n),l.rotation.set(e.x,e.y,e.z),l.scale.set(t,t,t),c.add(l),l}function Te(c,n){B(n,!1);let e=j(),t,a,r,i,s;const p="threeAtTable",l="dummy",d=[{playerName:"male",model:C.male},{playerName:"female",model:C.female},{playerName:"robot",model:C.robot}],u=500,P=1;function _(){const m=ce(f(e),b);t=m.scene,i=m.camera,a=m.renderer,N(e,m.container),s=new Le(p,t),s.load(d,l),s.setPlayerCharacterHeadLook("male",new o(Math.PI,Math.PI,0)),r=new ve(i,8,{horizontalFOV:100,verticalFOV:75,sensitivity:1}),r.attach(f(e)),de(t,a,P),x(),b()}async function x(){Se(t);const m=await I("/Props/Table","Table");m.position.set(2.5,-3,-2),m.scale.set(7,7,7),t.add(m);const h=30,w={minX:-h,maxX:h,minY:-h,maxY:h,minZ:-h,maxZ:h},Z=new pe(.01,32,32),O=new me({color:16777215,metalness:.1,roughness:.3}),q=new X(Z,O);for(let z=0;z<u;z++){const k=q.clone(),Q=w.minX+Math.random()*(w.maxX-w.minX),R=w.minY+Math.random()*(w.maxY-w.minY),U=w.minZ+Math.random()*(w.maxZ-w.minZ),T=2+Math.random()*2;k.scale.set(T,T,T),k.position.set(Q,R,U),k.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),t.add(k)}}function b(){if(requestAnimationFrame(b),a&&t&&i&&a.render(t,i),r){if(r.update(),!r.camera)return;const m=-r.camera.rotation.x,h=-r.camera.rotation.y;s.setPlayerCharacterHeadLook("male",new o(m,h,0)),s.setPlayerCharacterHeadLook("female",new o(m,h,0)),s.setPlayerCharacterHeadLook("robot",new o(m,h,0))}}function v(){r&&f(e)&&r.detach(f(e)),a&&a.dispose()}ue(()=>(f(e)&&_(),()=>{v()})),we(()=>{v()}),E(),le(c,{get container(){return f(e)},set container(m){N(e,m)},$$legacy:!0}),F()}var $e=S("<!> <!>",1);function Ae(c){var n=$e(),e=W(n);Te(e,{});var t=M(e,2);Pe(t,{}),L(c,n)}var Ie=S("<!> <!>",1);function Ee(c){var n=Ie(),e=W(n);he(e);var t=M(e,2);Ae(t),L(c,n)}export{Ee as component};
